# Secure connectivity patterns to access Amazon MSK across AWS Regions | AWS Big Data Blog (aws.amazon.com)

<https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/>

## Description

August 2023: Amazon MSK now offers a managed feature called multi-VPC private connectivity to simplify connectivity of your Kafka clients to your brokers. Refer this blog to learn more. AWS customers often segment their workloads across accounts and Amazon Virtual Private Cloud (Amazon VPC) to streamline access management while being able to expand their footprint. […]

## Content

[Skip to Main Content](#aws-page-content-main){#aws-page-skip-to-main .lb-sr-only .lb-sr-only-focusable .lb-bold .lb-skip-el}

[Click here to return to Amazon Web Services homepage](https://aws.amazon.com/?nc2=h_lg)

[Contact Us](https://aws.amazon.com/contact-us/?nc2=h_header)
[Support  ](#){#popover-popover-support-selector-trigger .lb-txt-none .lb-tiny-iblock .lb-txt-13 .lb-txt .lb-has-trigger-indicator mbox-ignore="true" lb-popover-trigger="popover-support-selector" role="button" aria-expanded="false" aria-label="Explore support options" aria-controls="popover-support-selector" aria-haspopup="true"}
[English ](#){#m-nav-language-selector .lb-tiny-iblock .lb-txt .lb-has-trigger-indicator lb-popover-trigger="popover-language-selector" data-language="en" aria-label="Set site language" role="button" aria-controls="popover-language-selector" aria-expanded="false" aria-haspopup="true"}
[My Account ](#){.lb-tiny-iblock .lb-txt .lb-has-trigger-indicator lb-popover-trigger="popover-my-account" aria-label="Access account options" role="button" aria-controls="popover-my-account" aria-expanded="false" aria-haspopup="true"}

[Sign In](https://console.aws.amazon.com/console/home?nc2=h_ct&src=header-signin){.lb-txt-none .lb-tiny-iblock .lb-txt-13 .lb-txt style="padding-top:8px; padding-right:13px;"}

[Create an AWS Account](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc2=h_ct&src=header_signup){.lb-btn-p-primary trk-params="{\"trkOverrideWithQs\":true}" role="button"}

-   [Products](https://aws.amazon.com/products/?nc2=h_ql_prod){panel="m-nav-panel-products"}
-   [Solutions](https://aws.amazon.com/solutions/?nc2=h_ql_sol){panel="m-nav-panel-solutions"}
-   [Pricing](https://aws.amazon.com/pricing/?nc2=h_ql_pr){panel="m-nav-panel-pricing"}
-   [Documentation](https://aws.amazon.com/documentation-overview/?nc2=h_ql_doc_do){panel="m-nav-panel-documentation"}
-   [Learn](https://aws.amazon.com/getting-started/?nc2=h_ql_le){panel="m-nav-panel-learn"}
-   [Partner Network](https://aws.amazon.com/partners/?nc2=h_ql_pn){panel="m-nav-panel-partner"}
-   [AWS Marketplace](https://aws.amazon.com/marketplace/?nc2=h_ql_mp){panel="m-nav-panel-marketplace"}
-   [Customer Enablement](https://aws.amazon.com/customer-enablement/?nc2=h_ql_ce){panel="m-nav-panel-customer"}
-   [Events](https://aws.amazon.com/events/?nc2=h_ql_ev){panel="m-nav-panel-events"}
-   [Explore More](https://aws.amazon.com/contact-us/?nc2=h_ql_exm){panel="m-nav-panel-more"}

[Close]{.lb-popover-close role="button" tabindex="0" aria-label="Close"}

-   [عربي](https://aws.amazon.com/ar/?nc1=h_ls)
-   [Bahasa Indonesia](https://aws.amazon.com/id/?nc1=h_ls)
-   [Deutsch](https://aws.amazon.com/de/?nc1=h_ls)
-   [English](https://aws.amazon.com/?nc1=h_ls)
-   [Español](https://aws.amazon.com/es/?nc1=h_ls)
-   [Français](https://aws.amazon.com/fr/?nc1=h_ls)
-   [Italiano](https://aws.amazon.com/it/?nc1=h_ls)
-   [Português](https://aws.amazon.com/pt/?nc1=h_ls)

```{=html}
<!-- -->
```
-   [Tiếng Việt](https://aws.amazon.com/vi/?nc1=f_ls)
-   [Türkçe](https://aws.amazon.com/tr/?nc1=h_ls)
-   [Ρусский](https://aws.amazon.com/ru/?nc1=h_ls)
-   [ไทย](https://aws.amazon.com/th/?nc1=f_ls)
-   [日本語](https://aws.amazon.com/jp/?nc1=h_ls)
-   [한국어](https://aws.amazon.com/ko/?nc1=h_ls)
-   [中文 (简体)](https://aws.amazon.com/cn/?nc1=h_ls)
-   [中文 (繁體)](https://aws.amazon.com/tw/?nc1=h_ls)

[Close]{.lb-popover-close role="button" tabindex="0" aria-label="Close"}

-   [My Profile](https://aws.amazon.com/profile/?nc2=h_m_mc)
-   [Sign out of AWS Builder ID](https://auth.aws.amazon.com/sign-out/?nc2=h_m_mc)
-   [AWS Management Console](https://console.aws.amazon.com/?nc2=h_m_mc)
-   [Account Settings](https://console.aws.amazon.com/billing/home#/account?nc2=h_m_ma)
-   [Billing & Cost Management](https://console.aws.amazon.com/billing/home?nc2=h_m_bc)
-   [Security Credentials](https://console.aws.amazon.com/iam/home?nc2=h_m_sc#security_credential)
-   [AWS Personal Health Dashboard](https://phd.aws.amazon.com/?nc2=h_m_sc)

[Close]{.lb-popover-close role="button" tabindex="0" aria-label="Close"}

-   [Support Center](https://console.aws.amazon.com/support/home/?nc2=h_ql_cu)
-   [Expert Help](https://iq.aws.amazon.com/?utm=mkt.nav)
-   [Knowledge Center](https://repost.aws/knowledge-center/?nc2=h_m_ma)
-   [AWS Support Overview](https://aws.amazon.com/premiumsupport/?nc2=h_m_bc)
-   [AWS re:Post](https://repost.aws/)

[Click here to return to Amazon Web Services homepage](https://aws.amazon.com/?nc2=h_lg)

[Get Started for Free](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc2=h_mobile){.lb-btn-p-primary role="button"}

[Contact Us](https://aws.amazon.com/contact-us/?nc2=h_mobile){.lb-btn-p role="button"}

-   [Products](https://aws.amazon.com/products/?nc2=h_mo)
-   [Solutions](https://aws.amazon.com/solutions/?nc2=h_mo)
-   [Pricing](https://aws.amazon.com/pricing/?nc2=h_mo)
-   [Introduction to AWS](https://aws.amazon.com/what-is-aws/?nc2=h_mo)
-   [Getting Started](https://aws.amazon.com/getting-started/?nc2=h_mo)
-   [Documentation](https://aws.amazon.com/documentation-overview/?nc2=h_mo)
-   [Training and Certification](https://aws.amazon.com/training/?nc2=h_mo)
-   [Developer Center](https://aws.amazon.com/developer/?nc2=h_mo)
-   [Customer Success](https://aws.amazon.com/solutions/case-studies/?nc2=h_mo)
-   [Partner Network](https://aws.amazon.com/partners/?nc2=h_mo)
-   [AWS Marketplace](https://aws.amazon.com/marketplace/?nc2=h_mo)
-   [Support](https://console.aws.amazon.com/support/home?nc2=h_ql_cu)
-   [AWS re:Post](https://repost.aws/)
-   [Log into Console](https://console.aws.amazon.com/console/home)
-   [Download the Mobile App](https://aws.amazon.com/console/mobile/)

[AWS Blog Home](/blogs){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[Blogs  ](#){#popover-blog-category-trigger .lb-txt-none .lb-txt .lb-has-trigger-indicator mbox-ignore="true" lb-popover-trigger="blog-category" role="button" aria-expanded="false" aria-label="Select blog category" aria-controls="blog-category" aria-haspopup="true" trk-params="{\"trkOverrideWithQs\":true}"}
[Editions  ](#){#popover-blog-editions-trigger .lb-txt-none .lb-txt .lb-has-trigger-indicator mbox-ignore="true" lb-popover-trigger="blog-editions" role="button" aria-expanded="false" aria-label="Select blog language" aria-controls="blog-editions" aria-haspopup="true" trk-params="{\"trkOverrideWithQs\":true}"}

[Close]{.lb-popover-close role="button" tabindex="0" aria-label="Close"}

[Architecture](https://aws.amazon.com/blogs/architecture/){.lb-txt-none .lb-txt}
[AWS Cloud Operations & Migrations](https://aws.amazon.com/blogs/mt/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[AWS for Games](https://aws.amazon.com/blogs/gametech/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[AWS Insights](https://aws.amazon.com/blogs/aws-insights/){.lb-txt-none .lb-txt}
[AWS Marketplace](https://aws.amazon.com/blogs/awsmarketplace/){.lb-txt-none .lb-txt}
[AWS News](https://aws.amazon.com/blogs/aws/){.lb-txt-none .lb-txt}
[AWS Partner Network](https://aws.amazon.com/blogs/apn/){.lb-txt-none .lb-txt}
[AWS Smart Business](https://aws.amazon.com/blogs/smb/){.lb-txt-none .lb-txt}
[Big Data](https://aws.amazon.com/blogs/big-data/){.lb-txt-none .lb-txt}
[Business Intelligence](https://aws.amazon.com/blogs/business-intelligence/){.lb-txt-none .lb-txt}
[Business Productivity](https://aws.amazon.com/blogs/business-productivity/){.lb-txt-none .lb-txt}
[Cloud Enterprise Strategy](https://aws.amazon.com/blogs/enterprise-strategy/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[Cloud Financial Management](https://aws.amazon.com/blogs/aws-cloud-financial-management/){.lb-txt-none .lb-txt}
[Compute](https://aws.amazon.com/blogs/compute/){.lb-txt-none .lb-txt}
[Contact Center](https://aws.amazon.com/blogs/contact-center/){.lb-txt-none .lb-txt}
[Containers](https://aws.amazon.com/blogs/containers/){.lb-txt-none .lb-txt}
[Database](https://aws.amazon.com/blogs/database/){.lb-txt-none .lb-txt}
[Desktop & Application Streaming](https://aws.amazon.com/blogs/desktop-and-application-streaming/){.lb-txt-none .lb-txt}
[Developer Tools](https://aws.amazon.com/blogs/developer/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[DevOps](https://aws.amazon.com/blogs/devops/){.lb-txt-none .lb-txt}
[Front-End Web & Mobile](https://aws.amazon.com/blogs/mobile/){.lb-txt-none .lb-txt}

[HPC](https://aws.amazon.com/blogs/hpc/){.lb-txt-none .lb-txt}
[Industries](https://aws.amazon.com/blogs/industries/){.lb-txt-none .lb-txt}
[Integration & Automation](https://aws.amazon.com/blogs/infrastructure-and-automation/){.lb-txt-none .lb-txt}
[Internet of Things](https://aws.amazon.com/blogs/iot/){.lb-txt-none .lb-txt}
[Machine Learning](https://aws.amazon.com/blogs/machine-learning/){.lb-txt-none .lb-txt}
[Media](https://aws.amazon.com/blogs/media/){.lb-txt-none .lb-txt}
[Messaging & Targeting](https://aws.amazon.com/blogs/messaging-and-targeting/){.lb-txt-none .lb-txt}
[Microsoft Workloads on AWS](https://aws.amazon.com/blogs/modernizing-with-aws/){.lb-txt-none .lb-txt}
[.NET on AWS](https://aws.amazon.com/blogs/dotnet/){.lb-txt-none .lb-txt}
[Networking & Content Delivery](https://aws.amazon.com/blogs/networking-and-content-delivery/){.lb-txt-none .lb-txt}
[Open Source](https://aws.amazon.com/blogs/opensource/){.lb-txt-none .lb-txt}
[Public Sector](https://aws.amazon.com/blogs/publicsector/){.lb-txt-none .lb-txt}
[Quantum Computing](https://aws.amazon.com/blogs/quantum-computing/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[Robotics](https://aws.amazon.com/blogs/robotics/){.lb-txt-none .lb-txt}
[SAP](https://aws.amazon.com/blogs/awsforsap/){.lb-txt-none .lb-txt}
[Security](https://aws.amazon.com/blogs/security/){.lb-txt-none .lb-txt trk-params="{\"trkOverrideWithQs\":true}"}
[Spatial Computing](https://aws.amazon.com/blogs/spatial/){.lb-txt-none .lb-txt}
[Startups](https://aws.amazon.com/blogs/startups/){.lb-txt-none .lb-txt}
[Storage](https://aws.amazon.com/blogs/storage/){.lb-txt-none .lb-txt}
[Supply Chain & Logistics](https://aws.amazon.com/blogs/supply-chain/){.lb-txt-none .lb-txt}
[Training & Certification](https://aws.amazon.com/blogs/training-and-certification/){.lb-txt-none .lb-txt}

[Close]{.lb-popover-close role="button" tabindex="0" aria-label="Close"}

-   [中国版](https://aws.amazon.com/cn/blogs/china/)
-   [日本版](https://aws.amazon.com/jp/blogs/news/)
-   [한국 에디션](https://aws.amazon.com/ko/blogs/korea/)
-   [기술 블로그](https://aws.amazon.com/ko/blogs/tech/)
-   [Edisi Bahasa Indonesia](https://aws.amazon.com/id/blogs/indonesia/)
-   [AWS Thai Blog](https://aws.amazon.com/th/blogs/thailand/)
-   [Édition Française](https://aws.amazon.com/fr/blogs/france/)
-   [Deutsche Edition](https://aws.amazon.com/de/blogs/germany/)
-   [Edição em Português](https://aws.amazon.com/pt/blogs/aws-brasil/)
-   [Edición en Español](https://aws.amazon.com/es/blogs/aws-spanish/)
-   [Версия на русском](https://aws.amazon.com/ru/blogs/rus/)
-   [Türkçe Sürüm](https://aws.amazon.com/tr/blogs/turkey/)

## [AWS Big Data Blog](https://aws.amazon.com/blogs/big-data/) {#aws-big-data-blog .lb-h5 .blog-title}

# Secure connectivity patterns to access Amazon MSK across AWS Regions {#secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions .lb-h2 .blog-post-title property="name headline"}

by
Sam Mokhtari,
Imtiaz Sayed,
Pooja Chikkala, and
Rajeev Chakrabarti \| on
03 AUG 2021 \| in
[Amazon Managed Streaming for Apache Kafka (Amazon MSK)](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-managed-streaming-for-apache-kafka/ "View all posts in Amazon Managed Streaming for Apache Kafka (Amazon MSK)"), [Analytics](https://aws.amazon.com/blogs/big-data/category/analytics/ "View all posts in Analytics") \|
[Permalink](https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){property="url"} \|
[ Comments](https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/#Comments) \|
[ Share](#){role="button" share-dialog-toggle=""}

-   [](https://www.facebook.com/sharer/sharer.php?u=https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){.lb-txt target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook"}
-   [](https://twitter.com/intent/tweet/?text=Secure%20connectivity%20patterns%20to%20access%20Amazon%20MSK%20across%20AWS%20Regions&via=awscloud&url=https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){.lb-txt target="_blank" rel="noopener noreferrer" aria-label="Share on Twitter"}
-   [](https://www.linkedin.com/shareArticle?mini=true&title=Secure%20connectivity%20patterns%20to%20access%20Amazon%20MSK%20across%20AWS%20Regions&source=Amazon%20Web%20Services&url=https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){.lb-txt target="_blank" rel="noopener noreferrer" aria-label="Share on LinkedIn"}
-   [](mailto:?subject=Secure%20connectivity%20patterns%20to%20access%20Amazon%20MSK%20across%20AWS%20Regions&body=Secure%20connectivity%20patterns%20to%20access%20Amazon%20MSK%20across%20AWS%20Regions%0A%0Ahttps://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){.lb-txt target="_blank" rel="noopener noreferrer" aria-label="Share on Email"}


***August 2023:** Amazon MSK now offers a managed feature called multi-VPC private connectivity to simplify connectivity of your Kafka clients to your brokers. Refer [this blog](https://aws.amazon.com/blogs/big-data/connect-kafka-client-applications-securely-to-your-amazon-msk-cluster-from-different-vpcs-and-aws-accounts/){target="_blank" rel="noopener"} to learn more.*

AWS customers often segment their workloads across accounts and [Amazon Virtual Private Cloud](https://aws.amazon.com/vpc/){target="_blank" rel="noopener noreferrer"} (Amazon VPC) to streamline access management while being able to expand their footprint. As a result, in some scenarios you, as an AWS customer, need to make an [Amazon Managed Streaming for Apache Kafka](https://aws.amazon.com/msk/){target="_blank" rel="noopener noreferrer"} (Amazon MSK) cluster accessible to Apache Kafka clients not only in the same Amazon VPC as the cluster but also in a remote Amazon VPC. A [guest post](https://aws.amazon.com/blogs/big-data/how-goldman-sachs-builds-cross-account-connectivity-to-their-amazon-msk-clusters-with-aws-privatelink/){target="_blank" rel="noopener noreferrer"} by Goldman Sachs presented cross-account connectivity patterns to an MSK cluster using [AWS PrivateLink](https://aws.amazon.com/privatelink/){target="_blank" rel="noopener noreferrer"}. Inspired by the work of Goldman Sachs, this post demonstrates additional connectivity patterns that can support both cross-account and cross-Region connectivity to an MSK cluster. We also developed sample code that supports the automation of the creation of resources for the connectivity pattern based on AWS PrivateLink.

## Overview

Amazon MSK makes it easy to run Apache Kafka clusters on AWS. It's a fully managed streaming service that automatically configures, and maintains Apache Kafka clusters and Apache Zookeeper nodes for you. Amazon MSK lets you focus on building your streaming solutions and supports familiar Apache Kafka ecosystem tools (such as [MirrorMaker](https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=27846330){target="_blank" rel="noopener noreferrer"}, Kafka Connect, and Kafka streams) and helps avoid the challenges of managing the Apache Kafka infrastructure and operations.

If you have workloads segmented across several VPCs and AWS accounts, there may be scenarios in which you need to make Amazon MSK cluster accessible to Apache Kafka clients across VPCs.  To provide secure connection between resources across multiple VPCs, AWS provides several networking constructs. Let's get familiar with these before discussing the different connectivity patterns:

-   [Amazon VPC peering](https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html){target="_blank" rel="noopener noreferrer"} is the simplest networking construct that enables bidirectional connectivity between two VPCs. You can use this connection type to enable between VPCs across accounts and AWS Regions to communicate with each other using private IP addresses.
-   [AWS Transit Gateway](https://docs.aws.amazon.com/vpc/latest/tgw/what-is-transit-gateway.html){target="_blank" rel="noopener noreferrer"} provides a highly available and scalable design for connecting VPCs. Unlike VPC peering that can go cross-Region, AWS Transit Gateway is a regional service, but you can use inter-Region peering between transit gateways to route traffic across Regions.

[AWS PrivateLink](https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-privatelink.html){target="_blank" rel="noopener noreferrer"} is an AWS networking service that provides private access to a specific service instead of all resources within a VPC and without traversing the public internet. You can use this service to expose your own application in a VPC to other users or applications in another VPC via an AWS PrivateLink-powered service (referred to as an *endpoint service*). Other AWS principals can then create a connection from their VPC to your endpoint service using an [interface VPC endpoint](https://docs.aws.amazon.com/vpc/latest/userguide/vpce-interface.html){target="_blank" rel="noopener noreferrer"}.

## Amazon MSK networking

When you create an MSK cluster, either via the [AWS Management Console](http://aws.amazon.com/console){target="_blank" rel="noopener noreferrer"} or [AWS Command Line Interface](http://aws.amazon.com/cli){target="_blank" rel="noopener noreferrer"} (AWS CLI), it's deployed into a managed VPC with brokers in private subnets (one per Availability Zone) as shown in the following diagram. Amazon MSK also creates the Apache ZooKeeper nodes in the same private subnets.

The brokers in the cluster are made accessible to clients in the customer VPC through elastic network interfaces (ENIs) that appear in the customer account. The security groups on the ENIs dictate the source and type of ingress and egress traffic allowed on the brokers.

IP addresses from the customer VPC are attached to the ENIs, and all network traffic stays within the AWS network and is not accessible to the internet.

Connections between clients and an MSK cluster are always private.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/bdb1186-msk-connectivity-patterns001.png){.alignnone .size-full .wp-image-18420 width="763" height="526"}

This blog demonstrates four connectivity patterns to securely access an MSK cluster from a remote VPC. The following table lists these patterns and their key characteristics. Each pattern aligns with the networking constructs discussed earlier.

<table data-border="1px">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="odd" style="background-color: #000000">
<td width="151"></td>
<td width="113">VPC Peering</td>
<td width="110">AWS Transit Gateway</td>
<td width="125">AWS PrivateLink with a single NLB</td>
<td width="125"><p> </p>
<p>WS PrivateLink multiple NLB</p>
<p> </p></td>
</tr>
<tr class="even">
<td width="151">Bandwidth</td>
<td width="113">Limited by instance network performance and flow limits.</td>
<td width="110">Up to 50 Gbps</td>
<td width="125"><p>10 Gbps per AZ</p>
<p> </p></td>
<td width="125"><p>10 Gbps per AZ</p>
<p> </p></td>
</tr>
<tr class="odd">
<td width="151">Pricing</td>
<td width="113">Data transfer charge (free if data transfer is within AZs)</td>
<td width="110">Data transfer charge + hourly charge per attachment</td>
<td width="125">Data transfer charge + interface endpoint charge + Network load balancer charge</td>
<td width="125">Data transfer charge + interface endpoint charge + Network load balancer charge</td>
</tr>
<tr class="even">
<td width="151">Scalability</td>
<td width="113">Recommended for smaller number of VPCs</td>
<td width="110">No limit on number of VPCs</td>
<td width="125">No limit on number of VPCs</td>
<td width="125">No limit on number of VPCs</td>
</tr>
</tbody>
</table>

Let's explore these connectivity options in more detail.

## VPC peering

To access an MSK cluster from a remote VPC, the first option is to create a peering connection between the two VPCs.

Let's say you use Account A to provision an MSK cluster in `us-east-1` Region, as shown in the following diagram. Now, you have an Apache Kafka client in the customer VPC in Account B that needs to access this MSK cluster. To enable this connectivity, you just need to create a peering connection between the VPC in Account A and the VPC in Account B. You should also consider implementing fine-grained network access controls with security groups to make sure that only specific resources are accessible between the peered VPCs.

Because VPC peering works across Regions, you can extend this architecture to provide access to Apache Kafka clients in another Region. As shown in the following diagram, to provide access to Kafka clients in the VPC of Account C, you just need to create another peering connection between the VPC in Account C with the VPC in Account A. The same networking principles apply to make sure only specific resources are reachable. In the following diagram, a solid line indicates a direct connection from the Kafka client to MSK cluster, whereas a dotted line indicates a connection flowing via VPC peering.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/bdb1186-msk-connectivity-patterns002.png){.alignnone .size-full .wp-image-18421 loading="lazy" width="873" height="626"}

VPC peering has the following benefits:\*

-   Simplest connectivity option.
-   Low latency.
-   No bandwidth limits (it is just limited by instance network performance and flow limits).
-   Lower overall cost compared to other VPC-to-VPC connectivity options.

However, it has some drawbacks:

-   VPC peering doesn't support transitive peering, which means that only directly peered VPCs can communicate with each other.
-   You can't use this connectivity pattern when there are overlapping IPv4 or IPv6 CIDR blocks in the VPCs.
-   Managing access can become challenging as the number of peered VPCs grows.

You can use VPC peering when the number of VPCs to be peered is less than 10.

## AWS Transit Gateway

AWS Transit Gateway can provide scalable connectivity to MSK clusters. The following diagram demonstrates how to use this service to provide connectivity to MSK cluster. Let's again consider a VPC in Account A running an MSK cluster, and an Apache Kafka client in a remote VPC in Account B is looking to connect to this MSK cluster. You set up AWS Transit Gateway to connect these VPCs and use route tables on the transit gateway to control the routing.

To extend this architecture to support access from a VPC in another Region, you need to use another transit gateway because this service can't span Regions. In other words, for the Apache Kafka client in Account C in `us-west-2` to connect to the MSK cluster, you need to peer another transit gateway in `us-west-2` with the transit gateway in `us-east-1` and work with the route tables to manage access to the MSK cluster. If you need to connect another account in `us-west-2`, you don't need an additional transit gateway. The Apache Kafka clients in the new account (Account D) simply require a connection to the existing transit gateway in `us-west-2` and the appropriate route tables.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/bdb1186-msk-connectivity-patterns003.png){.alignnone .size-full .wp-image-18422 loading="lazy" width="875" height="627"}

The hub and spoke model for AWS Transit Gateway simplifies management at scale because VPCs only need to connect to one transit gateway per Region to gain access to the MSK cluster in the attached VPCs. However, this setup has some drawbacks:

-   Unlike VPC peering in which you only pay for data transfer charges, Transit Gateway has an hourly charge per attachment in addition to the data transfer fee.
-   This connectivity pattern doesn't support transitive routing.
-   Unlike VPC peering, Transit Gateway is an additional hop between VPCs which may cause more latency.
-   It has higher latency (an additional hop between VPCs) comparing to VPC Peering.
-   The maximum bandwidth (burst) per Availability Zone per VPC connection is 50 Gbps.

You can use AWS Transit Gateway when you need to provide scalable access to the MSK cluster.

## AWS PrivateLink

To provide private, unidirectional access from an Apache Kafka client to an MSK cluster across VPCs, you can use AWS PrivateLink. This also eliminates the need to expose the entire VPC or subnet and prevents issues like having to deal with overlapping CIDR blocks between the VPC that hosts the MSK cluster ENIs and the remote Apache Kafka client VPC.

Let's do a quick recap of the architecture as explained in blog post [How Goldman Sachs builds cross-account connectivity to their Amazon MSK clusters with AWS PrivateLink](https://aws.amazon.com/blogs/big-data/how-goldman-sachs-builds-cross-account-connectivity-to-their-amazon-msk-clusters-with-aws-privatelink/){target="_blank" rel="noopener noreferrer"}.

Let's assume Account A has a VPC with three private subnets and an MSK cluster with three broker nodes in a 3-AZ deployment. You have three ENIs, one for each broker node in each subnet representing the broker nodes, and each ENI gets a private IPv4 address from its subnet's CIDR block, and an MSK broker DNS endpoint. To expose the MSK cluster in Account A to other accounts via AWS PrivateLink, you have to create a VPC endpoint service in Account A. The VPC endpoint service requires the entity, in this case the MSK cluster, to be fronted by a [Network Load Balancer](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html){target="_blank" rel="noopener noreferrer"} (NLB).

You can choose from two patterns using AWS PrivateLink to provide cross-account access to Amazon MSK: with a single NLB or multiple NLBs.

### AWS PrivateLink connectivity pattern with a single NLB

The following diagram illustrates access to an MSK cluster via an AWS PrivateLink connectivity pattern with a single NLB.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/bdb1186-msk-connectivity-patterns004.png){.alignnone .size-full .wp-image-18423 loading="lazy" width="1215" height="667"}

In this pattern, you have a single dedicated internal NLB in Account A. The NLB has a separate listener for each MSK broker. Because this pattern has a single NLB endpoint, each of the listeners need to listen on unique port. In the preceding diagram, the ports are depicted as 8443, 8444, and 8445. Correspondingly, for each listener, you have a unique target group, each of which has a single registered target: the IP address of an MSK broker ENI. Because the ports are different from the advertised listeners defined in the MSK cluster for each of the broker nodes, the advertised listeners configuration for each of the broker nodes in the cluster should be updated. Additionally, one target group has all the broker ENI IPs as targets and a corresponding listener (on port 9094), which means a request coming to the NLB on port 9094 can be routed to any of the MSK brokers.

In Account B, you need to create a corresponding VPC endpoint for the VPC endpoint service in Account A. Apache Kafka clients in Account B can connect to the MSK cluster in Account B by directing their requests to the VPC endpoint. For Transport Layer Security (TLS) to work, you also need an [Amazon Route 53](https://aws.amazon.com/route53/){target="_blank" rel="noopener noreferrer"} [private hosted zone](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zones-private.html){target="_blank" rel="noopener noreferrer"} with the domain name `kafka.<region of the amazon msk cluster>.amazonaws.com`, with alias resource record sets for each of the broker endpoints pointing to the VPC endpoint in Account B.

In this pattern, for the Apache Kafka clients local to the VPC with the Amazon MSK broker ENIs in Account A to connect to the MSK cluster, you need to set up a Route 53 private hosted zone, similar to Account B, with alias resource record sets for each of the broker endpoints pointing to the NLB endpoint. This is because the ports in the `advertised.listener` configuration have been changed for the brokers and the default Amazon MSK broker endpoints won't work.

To extend this connectivity pattern and provide access to Apache Kafka clients in a remote Region, you need to create a peering connection (which can be via VPC peering or AWS Transit Gateway) between the VPC in Account B and the VPC in the remote Region. The same networking principles apply to make sure only specific intended resources are reachable.

### AWS PrivateLink connectivity pattern with multiple NLBs

In the second pattern, you don't share one VPC endpoint service or NLB across multiple MSK brokers. Instead, you have an independent set for each broker. Each NLB has only one listener listening on the same port (9094) for requests to each Amazon MSK broker. Correspondingly, you have a separate VPC endpoint service for each NLB and each broker. Just like in the first pattern, in Account B, you need a Route53 hosted private zone to alias broker DNS endpoints to VPC endpoints---in this case, they're aliased to their own specific VPC endpoint.

This pattern has the advantage of not having to modify the advertised listeners configuration in the MSK cluster. However, there is an additional cost of deploying more NLBs, one for each broker. Furthermore, in this pattern, Apache Kafka clients that are local to the VPC with the MSK broker ENIs in Account A can connect to the cluster as usual with no additional setup needed. The following diagram illustrates this setup.

To extend this connectivity pattern and provide access to Apache Kafka clients in a remote Region, you need to create a peering connection between the VPC in Account B and the VPC in the remote Region.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/bdb1186-msk-connectivity-patterns005.png){.alignnone .size-full .wp-image-18424 loading="lazy" width="1220" height="671"}

You can use the [sample code](https://github.com/aws-samples/private-link-cross-account-access-for-msk){target="_blank" rel="noopener noreferrer"} provided on GitHub to set up the AWS PrivateLink connectivity pattern with multiple NLBs for an MSK cluster. The intent of the code is to automate the creation of multiple resources instead of wiring it manually.

These patterns have the following benefits:

-   They are scalable solutions and do not limit the number of consumer VPCs.
-   AWS PrivateLink allows for VPC CIDR ranges to overlap.
-   You don't need path definitions or a route table (access only to the MSK cluster), therefore it's easier to manage

** **The drawbacks are as follows:

-   The VPC endpoint and service must be in the same Region.
-   The VPC endpoints support IPv4 traffic only.
-   The endpoints can't be transferred from one VPC to another.

You can use either connectivity pattern when you need your solution to scale to a large number of Amazon VPCs that can consume each service. You can also use either pattern when the cluster and client VPCs have overlapping IP addresses and when you want to restrict access to only the MSK cluster instead of the VPC itself. The single NLB pattern adds relevant complexity to the architecture because you need to maintain an additional target group and listener that has all brokers registered as well as keep the `advertised.listeners` property up to date. You can offset that complexity with the multiple NLB pattern but at an additional cost for the increased number of NLBs.

## Conclusion

In this post, we explored different secure connectivity patterns to access an MSK cluster from a remote VPC. We also discussed the advantages, challenges, and limitations of each connectivity pattern. You can use this post as guidance to help you identify an appropriate connectivity pattern to address your requirements for accessing an MSK cluster. You can also use a combination of connectivity patterns to address your use case.

## References

To read more about the solutions that inspired this post, see [How Goldman Sachs builds cross-account connectivity to their Amazon MSK clusters with AWS PrivateLink](https://aws.amazon.com/blogs/big-data/how-goldman-sachs-builds-cross-account-connectivity-to-their-amazon-msk-clusters-with-aws-privatelink/){target="_blank" rel="noopener noreferrer"} and the webinar [Cross-Account Connectivity Options for Amazon MSK](https://www.twitch.tv/videos/695644473){target="_blank" rel="noopener noreferrer"}.

------------------------------------------------------------------------

### About the Authors

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/sammokhtari.jpg){.alignleft .size-full .wp-image-18428 loading="lazy" width="100" height="150"}**Dr. Sam Mokhtari** is a Senior Solutions Architect in AWS. His main area of depth is data and analytics, and he has published more than 30 influential articles in this field. He is also a respected data and analytics advisor who led several large-scale implementation projects across different industries including energy, health, telecom, and transport.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/poojachikkala.jpg){.alignleft .size-full .wp-image-18426 loading="lazy" width="100" height="134"}**Pooja Chikkala** is a Solutions Architect in AWS. Big data and analytics is her area of interest. She has 13 years of experience leading large-scale engineering projects with expertise in designing and managing both on-premises and cloud-based infrastructures.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/rajeev-chakrabarti.jpg){.alignleft .size-full .wp-image-18427 loading="lazy" width="100" height="136"}**Rajeev Chakrabarti** is a Principal Developer Advocate with the Amazon MSK team. He has worked for many years in the big data and data streaming space. Before joining the Amazon MSK team, he was a Streaming Specialist SA helping customers build streaming pipelines.

![](https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2021/05/19/imtiaz-sayed.jpg){.alignleft .size-full .wp-image-18425 loading="lazy" width="100" height="120"}**Imtiaz (Taz) Sayed** is the WW Tech Leader for Analytics at AWS. He enjoys engaging with the community on all things data and analytics, and can be reached at [**IN**](https://www.linkedin.com/in/contacttaz/){target="_blank" rel="noopener noreferrer"}.

## Comments {#Comments}

[View Comments](https://commenting.awsblogs.com/embed-1.0.html?disqus_shortname=aws-big-data-blog&disqus_identifier=18419&disqus_title=Secure+connectivity+patterns+to+access+Amazon+MSK+across+AWS+Regions&disqus_url=https://aws.amazon.com/blogs/big-data/secure-connectivity-patterns-to-access-amazon-msk-across-aws-regions/){property="discussionUrl"}

### Resources {#Resources .lb-txt-none .lb-h3 .lb-title style="margin-top:30px;"}

-   [Amazon Athena](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-athena?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)
-   [Amazon EMR](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-emr?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)
-   [Amazon Kinesis](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-kinesis?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)
-   [Amazon MSK](https://aws.amazon.com/msk/)
-   [Amazon QuickSight](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-quicksight?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)
-   [Amazon Redshift](https://aws.amazon.com/blogs/big-data/category/analytics/amazon-redshift-analytics?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)
-   [AWS Glue](https://aws.amazon.com/blogs/big-data/category/analytics/aws-glue?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-resources)

------------------------------------------------------------------------

### Follow {#Follow .lb-txt-none .lb-h3 .lb-title}

-   [  Twitter](https://twitter.com/awscloud)
-   [  Facebook](https://www.facebook.com/amazonwebservices)
-   [  LinkedIn](https://www.linkedin.com/company/amazon-web-services/)
-   [  Twitch](https://www.twitch.tv/aws)
-   [  Email Updates](https://pages.awscloud.com/communication-preferences?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=bigdata-social)

[Sign In to the Console](https://console.aws.amazon.com/console/home?nc1=f_ct&src=footer-signin-mobile){.lb-btn-p-primary role="button"}

### Learn About AWS {#learn-about-aws .lb-txt-none .lb-txt-white .lb-tiny-v-margin .lb-h3 .lb-title}

-   [What Is AWS?](https://aws.amazon.com/what-is-aws/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [What Is Cloud Computing?](https://aws.amazon.com/what-is-cloud-computing/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [AWS Inclusion, Diversity & Equity](https://aws.amazon.com/diversity-inclusion/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [What Is DevOps?](https://aws.amazon.com/devops/what-is-devops/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [What Is a Container?](https://aws.amazon.com/containers/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [What Is a Data Lake?](https://aws.amazon.com/big-data/datalakes-and-analytics/what-is-a-data-lake/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [AWS Cloud Security](https://aws.amazon.com/security/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [What\'s New](https://aws.amazon.com/new/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [Blogs](https://aws.amazon.com/blogs/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [Press Releases](https://press.aboutamazon.com/press-releases/aws "Press Releases"){target="_blank" rel="noopener noreferrer"}

### Resources for AWS {#resources-for-aws .lb-txt-none .lb-txt-white .lb-tiny-v-margin .lb-h3 .lb-title}

-   [Getting Started](https://aws.amazon.com/getting-started/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [Training and Certification](https://aws.amazon.com/training/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [AWS Solutions Library](https://aws.amazon.com/solutions/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [Architecture Center](https://aws.amazon.com/architecture/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [Product and Technical FAQs](https://aws.amazon.com/faqs/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [Analyst Reports](https://aws.amazon.com/resources/analyst-reports/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [AWS Partners](https://aws.amazon.com/partners/work-with-partners/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}

### Developers on AWS {#developers-on-aws .lb-txt-none .lb-txt-white .lb-tiny-v-margin .lb-h3 .lb-title}

-   [Developer Center](https://aws.amazon.com/developer/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [SDKs & Tools](https://aws.amazon.com/developer/tools/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [.NET on AWS](https://aws.amazon.com/developer/language/net/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [Python on AWS](https://aws.amazon.com/developer/language/python/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [Java on AWS](https://aws.amazon.com/developer/language/java/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [PHP on AWS](https://aws.amazon.com/developer/language/php/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [JavaScript on AWS](https://aws.amazon.com/developer/language/javascript/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}

### Help {#help .lb-txt-none .lb-txt-white .lb-tiny-v-margin .lb-h3 .lb-title}

-   [Contact Us](https://aws.amazon.com/contact-us/?nc1=f_m){target="_blank" rel="noopener noreferrer"}
-   [Get Expert Help](https://iq.aws.amazon.com/?utm=mkt.foot/?nc1=f_m){target="_blank" rel="noopener noreferrer"}
-   [File a Support Ticket](https://console.aws.amazon.com/support/home/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [AWS re:Post](https://repost.aws/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [Knowledge Center](https://repost.aws/knowledge-center/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [AWS Support Overview](https://aws.amazon.com/premiumsupport/?nc1=f_dr){target="_blank" rel="noopener noreferrer"}
-   [Legal](https://aws.amazon.com/legal/?nc1=f_cc){target="_blank" rel="noopener noreferrer"}
-   [AWS Careers](https://aws.amazon.com/careers/)

[Create an AWS Account](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc1=f_ct&src=default){.lb-btn-p-primary role="button"}

[](https://twitter.com/awscloud "Twitter"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-left:0px; padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://www.facebook.com/amazonwebservices "Facebook"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-none-v-margin .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://www.linkedin.com/company/amazon-web-services/ "Linkedin"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://www.instagram.com/amazonwebservices/ "Instagram"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://www.twitch.tv/aws "Twitch"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://www.youtube.com/user/AmazonWebServices/Cloud/ "YouTube"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://aws.amazon.com/podcasts/ "Podcast"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

[](https://pages.awscloud.com/communication-preferences?trk=homepage "Email"){.lb-txt-none .lb-txt-white .lb-none-pad .lb-txt style="padding-right:5px;" target="_blank" rel="noopener noreferrer"}

Amazon is an Equal Opportunity Employer:
*Minority / Women / Disability / Veteran / Gender Identity / Sexual Orientation / Age.*

-   Language
-   [عربي](https://aws.amazon.com/ar/?nc1=h_ls)
-   [Bahasa Indonesia](https://aws.amazon.com/id/?nc1=h_ls)
-   [Deutsch](https://aws.amazon.com/de/?nc1=h_ls)
-   [English](https://aws.amazon.com/?nc1=h_ls)
-   [Español](https://aws.amazon.com/es/?nc1=h_ls)
-   [Français](https://aws.amazon.com/fr/?nc1=h_ls)
-   [Italiano](https://aws.amazon.com/it/?nc1=h_ls)
-   [Português](https://aws.amazon.com/pt/?nc1=h_ls)
-   [Tiếng Việt](https://aws.amazon.com/vi/?nc1=f_ls)
-   [Türkçe](https://aws.amazon.com/tr/?nc1=h_ls)
-   [Ρусский](https://aws.amazon.com/ru/?nc1=h_ls)
-   [ไทย](https://aws.amazon.com/th/?nc1=f_ls)
-   [日本語](https://aws.amazon.com/jp/?nc1=h_ls)
-   [한국어](https://aws.amazon.com/ko/?nc1=h_ls)
-   [中文 (简体)](https://aws.amazon.com/cn/?nc1=h_ls)
-   [中文 (繁體)](https://aws.amazon.com/tw/?nc1=h_ls)

```{=html}
<!-- -->
```
-   [Privacy](https://aws.amazon.com/privacy/?nc1=f_pr)
-   \|
-   [Site Terms](https://aws.amazon.com/terms/?nc1=f_pr)
-   \|
-   [Cookie Preferences](#)
-   \|
-   © 2023, Amazon Web Services, Inc. or its affiliates. All rights reserved.
